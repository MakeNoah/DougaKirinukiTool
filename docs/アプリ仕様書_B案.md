# 📘 動画切り抜きツール 仕様まとめ

## 📝 概要

YouTubeの動画を対象に、特定のキーワードや音響イベントを検出し、その周辺の音声・字幕・動画を自動抽出・切り抜きするツールを開発する。本ツールは簡易GUI（初期はStreamlit等）を備え、プロトタイピングから商用品質を視野に段階的に進化させていく。

---

## 📋 機能一覧とステップ別ロードマップ

| #  | 機能カテゴリ   | 機能詳細                  | 実装ステップ  | 備考                        |
| -- | -------- | --------------------- | ------- | ------------------------- |
| 1  | 入力管理     | YouTube URLの登録        | STEP1   | `yt-dlp`使用。URLリスト or 単発対応 |
| 2  |          | ローカル動画ファイルの読み込み       | STEP2以降 | MVPではスキップ可能               |
| 3  |          | URLリスト・ファイル一覧表示       | STEP1   | シンプルなリスト表示でOK             |
| 4  |          | 永続化（動画・処理情報）          | STEP3   | SQLite使用、後回し可能            |
| 5  | 動画DL/抽出  | YouTube動画をDL          | STEP1   | `yt-dlp`                  |
| 6  |          | 音声抽出(mp3/wav)         | STEP1   | `ffmpeg` 使用               |
| 7  | 文字起こし    | Whisperで文字起こし         | STEP1   | baseモデル想定（音質次第で変更）        |
| 8  |          | YouTube字幕の利用（ある場合）    | STEP3   | 公式APIまたはyt-dlp subtitle機能 |
| 9  |          | 編集・修正機能（GUI）          | STEP3   | SRTの編集UIなど、優先度中           |
| 10 |          | 表記ゆれ対応辞書              | STEP2   | 初期は単純な正規化で代用可能            |
| 11 | キーワード処理  | 抽出キーワードの登録・管理         | STEP1   | GUI or configファイル対応       |
| 12 |          | 検出ロジック（前後N秒）          | STEP1   | テキストマッチ＋タイムスタンプ処理         |
| 13 | 音響イベント対応 | 耳ふー／タッピング音など検出        | STEP3   | 要音響処理（FFT＋判定器）            |
| 14 | 出力処理     | 音声クリップ（mp3/wav）出力     | STEP1   | ffmpegで区間出力               |
| 15 |          | 動画クリップ（mp4）出力         | STEP2   | 音声と同様にffmpegで可能           |
| 16 |          | 字幕ファイル（srt/vtt）出力     | STEP1   | whisper API出力を整形          |
| 17 |          | 出力パス・命名規則指定           | STEP2   | 初期は固定出力で可                 |
| 18 | GUI機能    | 処理一覧＋進捗表示             | STEP1   | Streamlit等で簡易に表示          |
| 19 |          | セグメント再生／調整（4:00→4:05） | STEP2   | 時間調整スライダー or 入力欄          |
| 20 |          | キーワード周辺確認画面           | STEP1   | 文字＋プレーヤーで表示               |
| 21 |          | 切り抜き修正して再出力           | STEP2   | GUI側から時間指定再処理             |
| 22 | DB管理     | SQLiteベース動画・処理管理      | STEP3   | 本格運用段階で導入                 |
| 23 | API設計    | 内部処理管理用REST/IPC API   | STEP3   | Electron/Tauri移行時に想定      |

---

## 📁 ディレクトリ構成案（Python + Streamlit）

```
asmr_cutter/
├── app.py                  # Streamlit GUIメイン
├── downloader/
│   └── youtube.py         # yt-dlpによるDL処理
├── transcriber/
│   └── whisper_runner.py  # whisperによる文字起こし
├── extractor/
│   └── keyword_extractor.py # キーワードによる抽出処理
│   └── segment_trimmer.py   # FFmpegによる切り抜き
├── ui/
│   └── controls.py        # GUI用コンポーネント
├── utils/
│   └── file.py            # ファイル保存や命名
│   └── timestamp.py       # 時間計算系
├── config/
│   └── keywords.json      # ユーザー指定キーワード
├── data/
│   └── raw/               # DL済ファイル
│   └── transcriptions/    # 文字起こし結果
│   └── segments/          # 抽出クリップ（mp3/wav）
└── requirements.txt       # 依存パッケージ
```

---

## 🧠 実装ざっくりメモ（各機能に対する流れ案）

* YouTube URL登録 → `yt-dlp` で `.mp4` 保存（`data/raw/`）

  * youtubeURLをどう登録するの？
  * 再実行時の処理は？再度DLはめんどいよね
* `ffmpeg` で `.mp3` 抽出（`data/raw/`内）
* `whisper` で `.txt` + `.srt` 出力（`data/transcriptions/`）

  * 最近whisperの最大サイズ並で0.5Bくらいのつよつよモデル出たから調査してほしいな
* `keywords.json` をロードし正規化（小文字、表記ゆれ吸収）

  * これ人間が手動でjson作るのめんどいからGUIから登録したいよね
* `.srt` or `.txt` からキーワード出現行を検索 → 前後5秒を抽出セグメントと定義

  * まあ一旦これはこれで、文字起こしと動画の時間ってどうやって対応させるの？
  * 単語が短い時間で連続してたら結合出来ると効率的かもなあ
* ffmpeg でその範囲を `.mp3` に切り出し（`data/segments/`）

  * 異存ないです、ただ既に切り抜いているものが存在してたら再度切り抜き走るのは非効率
    動画ごとにユニークな専用フォルダを用意しといてそこを参照したいところ
* Streamlit上でセグメント再生、時間微調整（例：スライダー）
* 新しい範囲で再切り抜き → 保存

  * ここは保存したらもとのものは上書きが良さそうかなあ
* GUIでの再生・確認・再出力まではMVPで対応
* 表記ゆれ辞書は `config/keywords.json` に正規化ペアで管理

  * これも単語ごとにGUIから追加したいね
* 音響イベント検出は `.wav` をFFT解析 → 条件マッチ検出器を後付け

  * 耳ふーの特定ってそもそも可能なのか…？と思っている、要サーベイ、原理的にはホワイトノイズの一種のような気がするが…
